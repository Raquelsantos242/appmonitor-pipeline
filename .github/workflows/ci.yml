  name: CI Pipeline

  env:
    ACTIONS_STEP_DEBUG: true

  on:
    push:
      branches:
        - ci/setup
    pull_request:
      branches:
        - ci/setup

  jobs:
    validate:
      name: Validate Script Syntax
      runs-on: ubuntu-latest
      steps:
        - uses: actions/checkout@v3
        - run: |
            if ! bash -n status-check.sh; then
              echo "::error::Falha na validação de sintaxe do script";
              exit 1;
            fi

    test:
      name: Run Tests
      runs-on: ubuntu-latest
      needs: validate
      steps:
        - uses: actions/checkout@v3
        - run: |
            echo "Running tests" && exit 0 || echo "::warning::Algum teste falhou"

    package:
      name: Package Artifact
      runs-on: ubuntu-latest
      needs: test
      steps:
        - uses: actions/checkout@v3
        - run: |
            echo "Test Results: PASS" > report.txt
            zip report.zip report.txt
        - uses: actions/upload-artifact@v4
          with:
            name: test-report
            path: report.zip
        - uses: actions/github-script@v6
          with:
            script: |
              const core = require('@actions/core');
              const { context } = require('@actions/github');
              const summary = core.summary;
              summary.addList([
                `${process.env.RUNNER_OS}`,
                `${context.ref.replace('refs/heads/', '')}`,
                `[Download report](${process.env.GITHUB_SERVER_URL}/${context.repo.owner}/${context.repo.repo}/actions/runs/${process.env.GITHUB_RUN_ID}/artifacts)`
              ]);
              summary.write();
    
